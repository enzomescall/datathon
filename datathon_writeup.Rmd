---
title: "Datathon Writeup"
author: "Linda Cao, Georgie Stammer, Enzo Moraes Mescall, Erik Mendes Novak"
date: "`r Sys.Date()`"
output: 
  pdf_document: 
    fig_height: 3
    fig_width: 4
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, 
                      message = FALSE, 
                      fig.align = "center")
```

```{r load-packages, echo = F, include = FALSE}
library(tidyverse)
library(knitr)
library(broom)
library(patchwork)
library(haven)
library(yardstick)
library(ggcorrplot)
```

```{r load-data, include= FALSE}
Wave1_data <- read_sav("Wave1_20170906.sav")
Wave1_data$index <- 1:nrow(Wave1_data)

predictors <- select(Wave1_data, c(country, level3,
                                   se002:se012a, se014:pgnum, index))
```

```{r clean-data, include= FALSE}
ideology_responses <- Wave1_data %>%
  select(index, q121:q148)

# This is our janky method of removing responses which failed to answer more
# than 4 questions
ideology_responses[is.na(ideology_responses)] <- 100000000

na_sum <- ideology_responses %>%
  mutate(sum = rowSums(ideology_responses[])) %>%
  filter(sum <499999999)

na_sum[na_sum > 100000] <- NA

cleaned_ideology_0 <- na_sum[, -31]
cleaned_ideology <- cleaned_ideology_0[, -1]

added_avg <- na_sum %>%
  select(index, q121, q122, q126:q128, q130:q132, q134:q147, q148)

added_avg$avg <- rowMeans(subset(na_sum, select = c(q121:q148)), na.rm = TRUE)

average_ideology <- select(added_avg, c(index, avg))

clean_data <- inner_join(average_ideology, predictors, by = "index")
```

```{r organise-clean-data, include= FALSE}
final_data <- clean_data %>%
  mutate(country = as.factor(country)) %>%
  mutate(urban_rural = as.factor(level3 - 1)) %>%
  mutate(gender = as.factor(se002 - 1)) %>%
  mutate(age = se003a) %>%
  mutate(marital_status = as.factor(se004a - 1)) %>%
  mutate(education = se005a) %>%
  mutate(household_members = se008a) %>%
  mutate(household_generations = se008b) %>%
  mutate(subjective_status = se017) %>%
  mutate(religion = case_when(se006 == 11 ~ 0, se006 < 11 ~ 1))

levels(final_data$country) <- c("Japan", "Hong Kong", "Korea", "China",
                          "Mongolia", "Philippines", "Taiwan", "Thailand")
```

### Introduction

Immediately after going over the data set our group was interested in section P of the questionnaire where individuals were asked a series of intense political questions and responded with their opinions. This provides a unique subjective insight of a population's perspective on their civic space. The data set provides information about the material conditions, and their perceived material conditions, of the surveyed and thus allows us to attempt to estimate the impact of an individual's material conditions on their political leanings. Notably, all the questions in section P are on a scale of 1 - 4 where answering 1 indicates support of a larger authoritarian government while answering 4.

#### Research Question

To what extent do an individual's material conditions affect their leanings toward authoritarian form of government?


### Methodology

To measure an individual's political leanings based off of their answers from the questionnaire we took their responses from questions Q121 to Q148 which scale from 1 to 4 and took the arithmetic mean across selected questions.

//space for erik
```{r correlation}
corr_ideology <- cor(cleaned_ideology, method = c("spearman"), use = "complete.obs")

ggcorrplot(corr_ideology, ggtheme = theme_bw(), tl.cex = 8,
           colors = c("#ebbb2a", "white", "#208756")) +
  labs(title = "Correlation between questions")
```

Next we look at the aforementioned questions in section P. 

### Exploratory Data Analysis

```{r}
ggplot(data = final_data, aes(x = avg)) +
  geom_histogram(fill = "#208756", color = "black", bins = 40) +
  labs(title = "Distribution of Political Leanings Index",
       x = "Political Leaning Index Value",
       y = "Count")  +
  theme_bw()
```
```{r, include = FALSE}
learning_index <- data.frame(mean(final_data$avg), max(final_data$avg), median(final_data$avg), min(final_data$avg), IQR(final_data$avg), sd(final_data$avg))
```

```{r}
kable(learning_index, digits = 3,
      caption = "Summary Statistics for Learning Index",
      col.names = c("Mean", "Max", "Median", "Min", "IQR", "SD"))
```

The distribution is unimodal, looks vaguely normal and doesn't have any apparent outliers.




### Data Analysis

After cleaning up the data we created a linear model using the responses to questions SE001 through SE017

### Conclusion